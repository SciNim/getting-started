<!DOCTYPE HTML>
<html lang="en-us" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using nimibook -->
        <meta charset="UTF-8">
        <title>Nimpy - The Nim Python bridge - SciNim Getting Started</title>

        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Tutorials for libraries in SciNim ecosystems">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üê≥</text></svg>">
        <link rel="stylesheet" href="../assets/css/variables.css">
        <link rel="stylesheet" href="../assets/css/general.css">
        <link rel="stylesheet" href="../assets/css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../assets/FontAwesome/css/font-awesome.min.css">

        <!-- Highlight.js Stylesheets - I could use nimib native highlight but let's keep it for styling... -->
        <link rel="stylesheet" href="../assets/css/highlight.css">
        <link rel="stylesheet" href="../assets/css/tomorrow-night.css">
        <link rel="stylesheet" href="../assets/css/ayu-highlight.css">

        <!-- Custom theme stylesheets - why the "../"? -->


        
        
        <!-- plausible analytics (new in nimibook) -->
        <script defer data-domain="scinim.github.io/getting-started" src="https://plausible.io/js/plausible.js"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "..//assets";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                                <ol class="chapter">
                <li class="chapter-item expanded ">
                  <a href="../index.html" tabindex="0">
                    <strong aria-hidden="true">1.</strong> Introduction
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../overview/index.html" tabindex="0">
                    <strong aria-hidden="true">2.</strong> Ecosystem overview
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../basics/index.html" tabindex="0">
                    <strong aria-hidden="true">3.</strong> Basic topics
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="../basics/common_datatypes.html" tabindex="0">
                    <strong aria-hidden="true">3.1.</strong> Common datatypes
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../basics/data_wrangling.html" tabindex="0">
                    <strong aria-hidden="true">3.2.</strong> Data wrangling with dataframes
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../basics/basic_plotting.html" tabindex="0">
                    <strong aria-hidden="true">3.3.</strong> Plotting
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../basics/units_basics.html" tabindex="0">
                    <strong aria-hidden="true">3.4.</strong> Units
                  </a></li>
                  </ol>
                  </li>
                <li class="chapter-item expanded ">
                  <a href="../numerical_methods/index.html" tabindex="0">
                    <strong aria-hidden="true">4.</strong> Numerical methods
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="../numerical_methods/curve_fitting.html" tabindex="0">
                    <strong aria-hidden="true">4.1.</strong> Curve fitting
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../numerical_methods/integration1d.html" tabindex="0">
                    <strong aria-hidden="true">4.2.</strong> Integration (1D)
                  </a></li>
                  </ol>
                  </li>
                <li class="chapter-item expanded ">
                  <a href="../data_viz/index.html" tabindex="0">
                    <strong aria-hidden="true">5.</strong> Data visualization
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="../data_viz/plotting_data.html" tabindex="0">
                    <strong aria-hidden="true">5.1.</strong> Plotting data
                  </a></li>
                  </ol>
                  </li>
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/index.html" tabindex="0">
                    <strong aria-hidden="true">6.</strong> Interfacing with other language
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/nim_with_py.html" class="active" tabindex="0">
                    <strong aria-hidden="true">6.1.</strong> Nimpy - The Nim Python bridge
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/julia/basics.html" tabindex="0">
                    <strong aria-hidden="true">6.2.</strong> Nimjl - The Nim Julia bridge
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/julia/nimjl_conversions.html" tabindex="0">
                    <strong aria-hidden="true">6.2.1.</strong> Advanced types
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/julia/nimjl_arrays.html" tabindex="0">
                    <strong aria-hidden="true">6.2.2.</strong> Julia Arrays from Nim
                  </a></li>
                  </ol>
                  </li>
                <li class="chapter-item expanded ">
                  <a href="../external_language_integration/nim_with_R.html" tabindex="0">
                    <strong aria-hidden="true">6.3.</strong> Interfacing with R
                  </a></li>
                </ol>
<!-- I could use also an unescaped context value -->
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">SciNim Getting Started</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/SciNim/getting-started" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1>Using Python with Nim</h1>
<p>In this tutorial, we explore how to use <a href="https://github.com/yglukhov/nimpy">Nimpy</a> to integrate Python code with Nim.</p>
<p>There are 2 potential motivations for using Python:</p>
<ul>
<li>Extending the Nim Scientific computing ecosystem; mostly with Scipy / Numpy.</li>
<li>Having a scripting language inside a compiled application</li>
</ul>
<p>There is a third use case : it's implementing Python module in Nim (for example, to speed up Python). While potentially useful, we will not cover it in this tutorial but you can read go check-out
<a href="https://github.com/Pebaz/Nimporter">nimporter</a>.</p>
<h2>Using Python as a scripting language in Nim</h2>
                        <pre><code class="nim hljs"><span class="hljs-keyword">import</span> nimpy
<span class="hljs-keyword">let</span> py = pyBuiltinsModule()
<span class="hljs-keyword">discard</span> py.print(<span class="hljs-string">&quot;Hello world from Python..&quot;</span>)</code></pre>
                        <p>That's basically all there is to it.
If you don't want to use the dot operator (which can get confusing), it is also possible use <code>callMethod</code> directly</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">discard</span> callMethod(py, <span class="hljs-string">&quot;print&quot;</span>, <span class="hljs-string">&quot;This is effectively identical to the previous call&quot;</span>)</code></pre>
                        <p>Most type conversion Nim -&gt; Python will be done automatically though Nimpy templates. Python -&gt; Nim type conversion has to be called manually with the <code>to()</code> API.</p>
<p>Let's see how it works in practice. In order to do that, we are going to create a local Python file with our custom functions, import it in Nim and call the Python function from Nim and convert the result back to Nim types.</p>
<p>The next portion will create said Python file using Nim code. If you're looking to reproduce this tutorial  at home, you can (and probably should) do it using your favorite text editor.</p>
                        <pre>mymod.py</pre>
<pre><code class="py hljs">def myfunc(inputArg):
    outputArg = {}
    outputArg[&quot;argFloat&quot;] = inputArg[&quot;argFloat&quot;] / 2
    outputArg[&quot;argStr&quot;] = inputArg[&quot;argStr&quot;][::-1]
    sortedList = sorted(inputArg[&quot;argSeq&quot;])
    outputArg[&quot;argSeq&quot;] = sortedList
    return outputArg
</code></pre>

                        <p>Now, onto the good parts :</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">type</span>
  <span class="hljs-type">MyObj</span>* = <span class="hljs-keyword">object</span>
    argFloat: <span class="hljs-built_in">float</span>
    argStr: <span class="hljs-built_in">string</span>
    argSeq: <span class="hljs-built_in">seq</span>[<span class="hljs-built_in">int</span>]

<span class="hljs-keyword">let</span>
  nimSeq: <span class="hljs-built_in">seq</span>[<span class="hljs-built_in">int</span>] = @[<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>]
  nimTup = <span class="hljs-type">MyObj</span>(argFloat: <span class="hljs-number">36.66</span>, argStr: <span class="hljs-string">&quot;I'm a string&quot;</span>, argSeq: nimSeq)

<span class="hljs-comment"># Let's import our Python file</span>
<span class="hljs-comment"># First, add the location of the Pythong to sys.path, as you would do in Python</span>
<span class="hljs-keyword">let</span> sys = pyImport(<span class="hljs-string">&quot;sys&quot;</span>)
<span class="hljs-keyword">discard</span> sys.path.append(getCurrentDir())
<span class="hljs-comment"># Second, import your file</span>
<span class="hljs-keyword">let</span> mymod = pyImport(<span class="hljs-string">&quot;mymod&quot;</span>)

<span class="hljs-keyword">let</span> retValue = mymod.myfunc(nimTup)
<span class="hljs-keyword">echo</span> typeof(retValue)
<span class="hljs-comment"># We can still use retValue as an argument for Python function</span>
<span class="hljs-keyword">discard</span> py.print(retValue)</code></pre><pre class="nb-output"><samp>PyObject</samp></pre>
                        <p>As you can see, by default every Python function called will return a PyObject. To convert this PyObject into a useful Nim type simply do :</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">let</span> nimValue = retValue.to(<span class="hljs-type">MyObj</span>)
<span class="hljs-keyword">echo</span> typeof(nimValue)
<span class="hljs-keyword">echo</span> nimValue</code></pre><pre class="nb-output"><samp>MyObj
(argFloat: 18.33, argStr: &quot;gnirts a m\'I&quot;, argSeq: @[1, 2, 3, 4, 5, 6, 7, 8])</samp></pre>
                        <p>Note that this example works with an object, but most Nim data structure are convertible to PyObject through Nimpy, including (but not limited to) : <code>Table, JsonNode, Set, OpenArray, Enum, Tuple</code> etc..</p>
<h2>Extending Nim through Scipy &amp; Numpy</h2>
<p>Now that we know how to use Python through Nim, let's see how we can use Nimpy / Scipy scientific functions through Nim.</p>
<p>The main difficulty is to work with the numpy ndarray type in Nim.</p>
<p>In order to do that, we'll use the <a href="https://github.com/SciNim/scinim/blob/main/scinim/numpyarrays.nim">scinim/numpyarrays API</a>.
By default, the conversion is done from/to Arraymancer Tensor; but the API covers <code>ptr UncheckedArray[T]</code> so it can be extended to any type with an underlying data buffer.</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">import</span> arraymancer
<span class="hljs-keyword">import</span> scinim/numpyarrays

<span class="hljs-keyword">let</span> np = pyImport(<span class="hljs-string">&quot;numpy&quot;</span>)
<span class="hljs-comment"># Create a Tensor</span>
<span class="hljs-keyword">var</span> mytensor = @[
  @[<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>],
  @[<span class="hljs-number">4.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6.0</span>],
  @[<span class="hljs-number">7.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">9.0</span>],
].toTensor

<span class="hljs-comment"># As you can see, Tensor are converted automatically to np.ndarray</span>
<span class="hljs-keyword">discard</span> py.print(mytensor)
<span class="hljs-keyword">var</span> myarray = toNdArray(mytensor)
<span class="hljs-keyword">echo</span> myarray.dtype()
<span class="hljs-keyword">echo</span> myarray.shape</code></pre><pre class="nb-output"><samp>&lt;class 'numpy.float64'&gt;
@[3, 3]</samp></pre>
                        <p>Now let's do a simple 1d interpolation using Scipy.</p>
<p>For simplicity, let's use a simple, straightforward function : $$f(x) = 10*x$$ and do a linear 1D interpolation. This makes the result easy to verify.</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">let</span> interp = pyImport(<span class="hljs-string">&quot;scipy.interpolate&quot;</span>)
<span class="hljs-keyword">var</span>
  mypoints = @[<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">8.0</span>, <span class="hljs-number">9.0</span>, ].toTensor
  myvalues = @[<span class="hljs-number">10.0</span>, <span class="hljs-number">20.0</span>, <span class="hljs-number">30.0</span>, <span class="hljs-number">40.0</span>, <span class="hljs-number">50.0</span>, <span class="hljs-number">60.0</span>, <span class="hljs-number">70.0</span>, <span class="hljs-number">80.0</span>, <span class="hljs-number">90.0</span>, ].toTensor
  x_coord = toNdArray(mypoints)
  y_coord = toNdArray(myvalues)

<span class="hljs-keyword">var</span> f_interp = interp.interp1d(x_coord, y_coord, <span class="hljs-string">&quot;linear&quot;</span>)
<span class="hljs-keyword">discard</span> py.print(f_interp)</code></pre>
                        <p>The result of interp1d is an interpolator function. In Nim, it's necessary to call it explicitly using <code>callObject</code> proc.</p>
                        <pre><code class="nim hljs"><span class="hljs-comment"># The result of interp2d is a function object that can be called through __call__</span>
<span class="hljs-keyword">var</span> val_at_new_point = callObject(f_interp, <span class="hljs-number">1.5</span>).to(<span class="hljs-built_in">float</span>)
<span class="hljs-comment"># Yay, we just did a BiCubic interpolation !</span>
<span class="hljs-keyword">echo</span> val_at_new_point</code></pre><pre class="nb-output"><samp>15.0</samp></pre>
                        <p>As expected, the result of the linear 1D interpolation evaluated on the coordinate 1.5 is 15.</p>
<p>Now let's do it on an Array :</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">var</span> new_points_coord = @[<span class="hljs-number">2.5</span>, <span class="hljs-number">3.5</span>, <span class="hljs-number">4.5</span>, <span class="hljs-number">5.5</span>]
<span class="hljs-keyword">var</span> new_values = callObject(f_interp, new_points_coord).toTensor[:<span class="hljs-built_in">float</span>]()
<span class="hljs-keyword">echo</span> new_values</code></pre><pre class="nb-output"><samp>Tensor[system.float] of shape &quot;[4]&quot; on backend &quot;Cpu&quot;
    25    35    45    55</samp></pre>
                        <p>The result of the linear 1D interpolation on <code>[2.5, 3.5, 4.5, 5.5]</code> is <code>[25, 35, 45, 55]</code>, as we expected !</p>
<p>(if you executed the code snippet as-is, don't forget to remove the generated Python file <code>mymod.py</code>).</p>
                        <p>And that's it, for this tutorial !</p>
<p>While simple, the approach presented here allows to re-use most (if not all) of the Scipy / Numpy API relying on ndarray and convert them to Arraymancer Tensor, a format easily used in Nim.</p>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../external_language_integration/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../external_language_integration/julia/basics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../external_language_integration/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../external_language_integration/julia/basics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>







        <script src="../assets/js/clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../assets/js/highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../assets/js/book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
